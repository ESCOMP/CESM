on:
  workflow_call:
    inputs:
      compiler:
        type: string
        required: true

jobs:
  test:
    env:
      CC: mpicc
      FC: mpifort
      CXX: mpicxx
      CIME_MODEL: cesm
      CIME_DRIVER: nuopc
    # needs: setup
    runs-on: hpc-runner
    steps:
      - name: Run ${{ inputs.compiler }} tests
        continue-on-error: true
        run: |
          pwd
          cd cime/scripts
          module load cmake
          qcmd -v PROJECT=P93300606 -A P93300606 -l walltime=02:00:00 -- ./create_test --xml-machine derecho\
              --xml-category github --no-run --compiler ${{ inputs.compiler }} --test-id $GITHUB_RUN_ID
      - name: check status
        run: |
          cd $SCRATCH
          ./cs.status.ghtest.${{ inputs.compiler }} --expected-fails-file $GITHUB_WORKSPACE/CESM/cime_config/testfiles/ExpectedTestFails.xml 